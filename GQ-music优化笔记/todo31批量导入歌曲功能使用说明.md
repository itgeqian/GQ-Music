# 批量导入歌曲功能使用说明

## 功能概述

批量导入歌曲功能允许管理员通过表格式界面，一次性导入多首歌曲到系统中。该功能支持拖拽上传音频和歌词文件，自动处理专辑信息，并提供完善的错误处理和导入结果统计。

## 功能特性

### 1. 两步式导入流程
- **第一步：选择专辑**：选择现有专辑或创建新专辑
- **第二步：表格导入**：在表格中填写歌曲信息并上传文件

### 2. 拖拽上传功能
- **音频文件上传**：支持拖拽MP3/FLAC格式的音频文件
- **歌词文件上传**：支持拖拽LRC格式的歌词文件（可选）
- **上传进度显示**：实时显示文件上传进度
- **文件格式验证**：自动验证文件格式是否正确

### 3. 内容类型选择
- **歌曲模式**：每首歌曲可以有不同的风格，适合音乐专辑导入
- **听书模式**：第一行选择风格后，其他行会自动同步相同风格，适合有声书、广播剧等系列内容导入
- **智能风格同步**：听书模式下减少重复操作，提高导入效率

### 4. 智能数据处理
- **自动填充信息**：专辑选择后自动填充相关信息
- **自动解析时长**：上传音频后自动解析歌曲时长
- **自动使用专辑封面**：新歌曲自动使用专辑封面
- **自动设置发行时间**：根据专辑信息自动设置发行时间

### 5. 数据验证
- 必填字段验证（歌名、音频文件）
- 文件格式验证（MP3/FLAC音频，LRC歌词）
- 重复歌曲检查（同一歌手的同名歌曲）
- 歌手存在性验证

### 6. 错误处理
- 详细的错误信息提示
- 失败行号定位
- 批量导入结果统计
- 失败原因说明

## 使用步骤

### 步骤1：选择歌手
1. 在歌曲管理页面的左侧歌手树中选择要导入歌曲的歌手
2. 确保已选择歌手后再进行批量导入操作

### 步骤2：打开批量导入对话框
1. 点击歌曲管理页面右上角的"批量导入"按钮
2. 系统会打开批量导入对话框，显示步骤指示器

### 步骤3：选择专辑（第一步）
1. **选择现有专辑**：
   - 在专辑网格中点击要使用的专辑
   - 系统会高亮显示选中的专辑
2. **创建新专辑**：
   - 点击"新建专辑"按钮
   - 输入新专辑名称
3. 点击"下一步"按钮进入表格导入界面

### 步骤4：表格导入（第二步）
1. **选择内容类型**：
   - **歌曲模式**：每首歌曲可以有不同的风格，适合音乐专辑导入
   - **听书模式**：第一行选择风格后，其他行会自动同步相同风格，适合有声书、广播剧等系列内容导入
2. **填写歌曲信息**：
   - 在表格的"歌曲名称"列中输入歌曲名称
   - 在表格的"歌曲风格"列中选择歌曲风格（下拉选择）
   - 每行对应一首歌曲
3. **上传音频文件**：
   - 将MP3或FLAC格式的音频文件拖拽到"音频文件"列的上传区域
   - 系统会显示上传进度条
   - 上传完成后会显示文件名
4. **上传歌词文件（可选）**：
   - 将LRC格式的歌词文件拖拽到"歌词文件"列的上传区域
   - 歌词文件为可选项，可以不填写
5. **管理表格行**：
   - 点击"添加行"按钮可以增加新的歌曲行
   - 点击"删除"按钮可以删除不需要的行
   - 系统默认提供10行，可以根据需要调整

### 步骤5：执行导入
1. 确认所有歌曲信息填写完整（歌曲名称、风格、音频文件）
2. 点击"批量导入"按钮
3. 系统会显示确认对话框，显示要导入的歌曲数量
4. 确认后开始批量导入，显示导入进度

### 步骤6：查看结果
1. 导入完成后会弹出结果对话框
2. 显示成功和失败的数量统计
3. 如有失败，会显示详细的失败原因和行号
4. 导入成功后，歌曲会出现在歌曲管理列表中

## 数据格式说明

### 文件格式要求
- **音频文件**：支持MP3、FLAC格式
- **歌词文件**：支持LRC格式（可选）
- **文件大小**：建议单个音频文件不超过50MB
- **文件命名**：建议使用有意义的文件名，便于识别

### 字段说明
| 字段名 | 是否必填 | 格式要求 | 说明 |
|--------|----------|----------|------|
| 歌曲名称 | 是 | 文本 | 歌曲名称，不能为空 |
| 歌曲风格 | 是 | 下拉选择 | 从预设风格中选择，不能为空 |
| 专辑 | 自动 | 文本 | 在第一步中选择的专辑名称 |
| 音频文件 | 是 | MP3/FLAC | 歌曲音频文件，通过拖拽上传 |
| 歌词文件 | 否 | LRC | 歌词文件，通过拖拽上传（可选） |
| 发行时间 | 自动 | YYYY-MM-DD | 根据专辑信息自动设置 |
| 时长 | 自动 | mm:ss | 上传音频后自动解析 |
| 封面 | 自动 | 图片 | 自动使用专辑封面 |

## 注意事项

### 1. 数据准备
- 确保歌曲名称准确无误
- 必须为每首歌曲选择风格
- 音频文件必须是MP3或FLAC格式
- 歌词文件必须是LRC格式（可选）
- 同一歌手的同名歌曲会被视为重复，导入失败

### 2. 文件要求
- 音频文件大小建议不超过50MB
- 歌词文件大小建议不超过1MB
- 单次导入建议不超过50首歌曲（避免页面卡顿）
- 文件命名建议使用有意义的名称

### 3. 系统限制
- 必须先选择歌手才能进行批量导入
- 导入过程中请勿关闭浏览器或刷新页面
- 导入失败的数据不会影响已成功导入的数据
- 表格默认显示10行，可以通过"添加行"按钮增加

## 错误处理

### 常见错误及解决方案

1. **"请先在左侧选择歌手"**
   - 解决：在歌手树中选择目标歌手

2. **"歌名不能为空"**
   - 解决：在表格中填写歌曲名称

3. **"歌曲风格不能为空"**
   - 解决：在表格中选择歌曲风格

4. **"音频文件不能为空"**
   - 解决：拖拽音频文件到对应的上传区域

5. **"音频文件格式不正确"**
   - 解决：确保音频文件是MP3或FLAC格式

6. **"歌曲已存在"**
   - 解决：检查是否已存在同名歌曲，或修改歌名

7. **"歌词文件格式不正确"**
   - 解决：确保歌词文件是LRC格式

8. **"音频文件数量与歌曲名称数量不匹配"**
   - 解决：确保每首歌曲都有对应的音频文件

9. **"歌曲名称数量与歌曲风格数量不匹配"**
   - 解决：确保每首歌曲都选择了风格

## 技术实现

### 后端接口
- **接口地址**：`POST /admin/batchImportSongs`
- **请求参数**：FormData格式，包含歌手ID、专辑名称、歌曲名称列表和文件
- **返回结果**：导入统计信息和失败详情

### 前端组件
- **主组件**：`vibe-music-admin-main/src/views/song/form/newBatchImport.vue`
- **专辑选择组件**：`vibe-music-admin-main/src/views/song/form/albumSelector.vue`
- **表格导入组件**：`vibe-music-admin-main/src/views/song/form/tableImport.vue`
- **集成位置**：歌曲管理页面
- **功能模块**：步骤导航、专辑选择、拖拽上传、进度显示、结果展示

## 更新日志

### v2.0.0 (2025-09-25) - 当前版本
- 重新设计批量导入流程：专辑选择 → 表格导入
- 实现拖拽上传功能，支持MP3/FLAC音频文件和LRC歌词文件
- 添加上传进度条和文件格式验证
- 智能数据处理：自动填充专辑信息、解析时长、设置封面
- 表格式界面，支持多行批量操作
- 完善的两步式导入流程和步骤指示器
- 清理了老版本代码，优化了代码结构
